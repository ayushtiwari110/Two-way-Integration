<!DOCTYPE html>
<html>
  <head>
    <title>Customer Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  </head>
  <body>
    <div class="container mt-5">
      <h1>Customers</h1>
      <div class="mb-3">
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCustomerModal">Add Customer</button>
        <button id="refreshButton" class="btn btn-info">Refresh Data</button>
        <a href="/" class="btn btn-secondary">Back to Dashboard</a>
      </div>

      <table class="table table-striped">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Stripe Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for customer in customers %}
          <tr>
            <td>{{ customer.id }}</td>
            <td>{{ customer.name }}</td>
            <td>{{ customer.email }}</td>
            <td>
              {% if customer.has_integration %}
              <span class="badge bg-success">Synced</span>
              {% else %}
              <span class="badge bg-warning">Not synced</span>
              {% endif %}
            </td>
            <td>
              <button
                class="btn btn-sm btn-warning"
                data-bs-toggle="modal"
                data-bs-target="#editCustomerModal"
                data-id="{{ customer.id }}"
                data-name="{{ customer.name }}"
                data-email="{{ customer.email }}"
              >
                Edit
              </button>
              <button class="btn btn-sm btn-danger btn-delete" data-id="{{ customer.id }}">Delete</button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Modal for adding customers -->
    <div class="modal fade" id="addCustomerModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Add New Customer</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form id="addCustomerForm">
            <div class="modal-body">
              <div class="mb-3">
                <label for="customerName" class="form-label">Name</label>
                <input type="text" class="form-control" id="customerName" required />
              </div>
              <div class="mb-3">
                <label for="customerEmail" class="form-label">Email</label>
                <input type="email" class="form-control" id="customerEmail" required />
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-primary">Add Customer</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- Modal for editing customers -->
    <div class="modal fade" id="editCustomerModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Edit Customer</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <form id="editCustomerForm">
            <div class="modal-body">
              <input type="hidden" id="editCustomerId" />
              <div class="mb-3">
                <label for="editCustomerName" class="form-label">Name</label>
                <input type="text" class="form-control" id="editCustomerName" required />
              </div>
              <div class="mb-3">
                <label for="editCustomerEmail" class="form-label">Email</label>
                <input type="email" class="form-control" id="editCustomerEmail" required />
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/customers.js"></script>
  </body>
</html>
